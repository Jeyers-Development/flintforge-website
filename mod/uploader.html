<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../css/styles.css">
<link rel="icon" type="image/png" href="../res/favicon.png">
<title>Mod Uploader (CMD curl)</title>
<style>
  .step { display: none; }
  .step.active { display: block; }
  label { display: block; margin-bottom: 10px; }
  textarea { background: #000000; color: white; }
  pre { background: #000000; color: white; padding: 10px; overflow-x: auto; white-space: pre-wrap; }
  button { margin-left: 0; margin-right: auto; display: block; margin-top: 5px; }
  div { color: white; }
  input, select { color: white; background: #000000; }
</style>
</head>
<body>
<div style="text-align: left; margin: 20px 0;">
    <button onclick="location.href = '../index.html'" 
            style="padding: 8px 15px; font-size: 16px; background: #966b42; color: white; border: none; border-radius: 4px; cursor: pointer; display: inline-block; margin: 0 2px;">
        Back
    </button>

    <button onclick="location.href = '/wikisrc/api-v1.html'" 
            style="padding: 8px 15px; font-size: 16px; background: #966b42; color: white; border: none; border-radius: 4px; cursor: pointer; display: inline-block; margin: 0 2px;">
        Modding API v1
    </button>
</div>

<h1>Mod Uploader (Windows CMD curl, --data-binary)</h1>

<!-- Step 1: Username / User Key -->
<div class="step active" id="step1">
  <h2>Step 1: Username / User Key</h2>
  <label>Username: <input type="text" id="username" required></label>
  <label>User Key: <input type="text" id="userkey" required></label>
  <button id="nextToStep2">Next</button>
  <br><br>
  <button id="registerBtn">Register New User</button>
  <p id="registerResult"></p>
  <h3>CMD curl to register (or copy):</h3>
  <pre id="registerCurl">---</pre>
</div>

<!-- Step 2: Mod Details -->
<div class="step" id="step2">
  <h2>Step 2: Mod Details</h2>

  <label>Action:
    <select id="action">
      <option value="upload">Upload</option>
      <option value="update">Update</option>
      <option value="delete">Delete</option>
    </select>
  </label>

  <label>Mod File Path (ex: C:/path/example_mod.jop): <input type="text" id="filepath" placeholder="Paste full path here"></label>

  <label>Permanent Name (same as 'permanent' file in mod archive): <input type="text" id="permanentName" placeholder="example_mod" required></label>

  <label>Title: <input type="text" id="title"></label>
  <label>Description: <textarea id="description"></textarea></label>
  <label>Authors: <input type="text" id="authors"></label>
  <label>Game Versions: <input type="text" id="gameversions"></label>
</div>

<h2>Auto-generated curl command (CMD-ready, --data-binary):</h2>
<pre id="curlOutput">---</pre>

<script>
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const nextToStep2Btn = document.getElementById('nextToStep2');
const registerBtn = document.getElementById('registerBtn');
const registerCurl = document.getElementById('registerCurl');
const curlOutput = document.getElementById('curlOutput');

let userkey = "";

// Escape quotes for CMD
function escapeCmd(str) {
  return str.replace(/(["^])/g,'^$1');
}

// Update curl command
function updateCurl() {
  const username = document.getElementById('username').value.trim();
  const title = document.getElementById('title').value.trim();
  const description = document.getElementById('description').value.trim();
  const authors = document.getElementById('authors').value.trim();
  const gameversions = document.getElementById('gameversions').value.trim();
  const filepath = document.getElementById('filepath').value.trim();
  const permanentName = document.getElementById('permanentName').value.trim() + ".jop";
  const action = document.getElementById('action').value;

  if (!username || !userkey || !permanentName || !action) {
    curlOutput.textContent = "---";
    return;
  }

  const params = new URLSearchParams({
    action: action,
    username: username,
    userkey: userkey,
    name: permanentName
  });

  if (action === "upload" || action === "update") {
    params.set("title", title);
    params.set("description", description);
    params.set("authors", authors);
    params.set("gameversions", gameversions);
  }

  let curlCmd = "";
  if (action === "delete") {
    curlCmd = `curl.exe -X DELETE "https://mod-uploader-worker.jakejem2010.workers.dev?${params.toString()}"`;
  } else {
    curlCmd = `curl.exe -X POST "https://mod-uploader-worker.jakejem2010.workers.dev?${params.toString()}" --data-binary "@${filepath}"`;
  }

  curlOutput.textContent = curlCmd;
}

// Step 1: Next
nextToStep2Btn.addEventListener('click', () => {
  const username = document.getElementById('username').value.trim();
  const key = document.getElementById('userkey').value.trim();
  if(!username || !key) { alert("Please enter all required fields."); return; }
  userkey = key;
  step1.classList.remove('active');
  step2.classList.add('active');
  updateCurl();
});

// Register button
registerBtn.addEventListener('click', () => {
  const username = document.getElementById('username').value.trim();
  if(!username) { alert("Enter username."); return; }

  // Generate curl for registration
  const curlCmd = `curl.exe -X POST "https://mod-uploader-worker.jakejem2010.workers.dev?action=register&username=${encodeURIComponent(username)}"`;
  registerCurl.textContent = curlCmd;

  alert("Copy this CMD curl to register your user. After registration, paste the returned userKey into the User Key field.");
});

// Update curl whenever any field changes
['title','description','authors','gameversions','filepath','permanentName','action'].forEach(id => {
  document.getElementById(id).addEventListener('input', updateCurl);
});
</script>
</body>
</html>
